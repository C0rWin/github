<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: puppet | Short notes]]></title>
  <link href="http://pensieve.info/blog/categories/puppet/atom.xml" rel="self"/>
  <link href="http://pensieve.info/"/>
  <updated>2013-10-22T14:23:58+03:00</updated>
  <id>http://pensieve.info/</id>
  <author>
    <name><![CDATA[C0rWin]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Putting all together setup, Hadoop cluster on VM with Puppet.]]></title>
    <link href="http://pensieve.info/blog/2013/09/30/putting-all-together-setup-hadoop-cluster-on-vm-with-puppet/"/>
    <updated>2013-09-30T00:14:00+03:00</updated>
    <id>http://pensieve.info/blog/2013/09/30/putting-all-together-setup-hadoop-cluster-on-vm-with-puppet</id>
    <content type="html"><![CDATA[<p>In my two previous blog post I&rsquo;ve explained:</p>

<ol>
<li><a href="blog/2013/09/21/setup-hadoop-cluster/">Setup Hadoop cluster</a> &ndash; manual configuration on virtual machines which needed to setup Hadoop cluster.</li>
<li><a href="blog/2013/09/21/install-java-on-vm-using-vagrant-and-puppet">Install Java on VM using vagrant and puppet</a> &ndash; I&rsquo;ve started to explain how to leverage vagrant and puppet in order to have Java installed in virtual machine.</li>
</ol>


<p>Now in this post I&rsquo;ll try to explain how-to setup hadoop cluster on virtual environment using vagrant and puppet scripts, so all actions in my first post could be easily automated.</p>

<p> <!-- more --></p>

<p> I&rsquo;m going to use my first two posts as a reference and assume you have downloaded all files needed, moreover you already have puppet module script for java install and configuration.</p>

<p>Start as usual:</p>

<h3>1. Create module folders:</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Widow </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir -p modules/hadoop/{files,manifests,templates}</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>2. Copy hadoop files into module folder:</h3>

<p>As I said I&rsquo;m going to use files from previous <a href="blog/2013/09/21/setup-hadoop-cluster/">post</a>
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp hadoop-1.2.1.tar.gz modules/hadoop/files/</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>3. Write implementation of hadoop module for puppet.</h3>

<p>Following script will download, unpack and setup hadoop on desired amount of virtual machines.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>init.pp </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="n">hadoop</span><span class="p">(</span> <span class="vg">$masterNode</span><span class="p">,</span> <span class="vg">$slaveNodes</span><span class="p">,</span> <span class="vg">$distrFile</span><span class="p">,</span> <span class="vg">$hadoopHome</span><span class="p">)</span> <span class="p">{</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;Exec {</span>
</span><span class='line'><span class="sr">    path =&amp;gt; [ &quot;/us</span><span class="n">r</span><span class="o">/</span><span class="n">bin</span><span class="s2">&quot;, &quot;</span><span class="o">/</span><span class="n">bin</span><span class="s2">&quot;, &quot;</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="s2">&quot;]</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">file { &quot;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">distrFile</span><span class="p">}</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="s2">&quot; :</span>
</span><span class='line'><span class="s2">    source =&amp;gt; &quot;</span><span class="ss">puppet</span><span class="p">:</span><span class="sr">//</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">hadoop</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">distrFile</span><span class="p">}</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    owner =&amp;gt;  vagrant,</span>
</span><span class='line'><span class="s2">    mode  =&amp;gt; 755,</span>
</span><span class='line'><span class="s2">    ensure =&amp;gt; present</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">exec { &quot;</span><span class="n">extract</span> <span class="n">distr</span><span class="s2">&quot;:</span>
</span><span class='line'><span class="s2">    cwd =&amp;gt; &quot;</span><span class="o">/</span><span class="n">tmp</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    command =&amp;gt; &quot;</span><span class="n">tar</span> <span class="n">xf</span> <span class="err">$</span><span class="p">{</span><span class="n">distrFile</span><span class="p">}</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    creates =&amp;gt; &quot;</span><span class="err">$</span><span class="p">{</span><span class="n">hadoopHome</span><span class="p">}</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    user =&amp;gt; vagrant,</span>
</span><span class='line'><span class="s2">    require =&amp;gt; File[&quot;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">distrFile</span><span class="p">}</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="s2">&quot;]</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">exec { &quot;</span><span class="n">move</span> <span class="n">distr</span><span class="s2">&quot;:</span>
</span><span class='line'><span class="s2">    cwd =&amp;gt; &quot;</span><span class="o">/</span><span class="n">tmp</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    command =&amp;gt; &quot;</span><span class="n">mv</span> <span class="err">$</span><span class="p">{</span><span class="n">distrFile</span><span class="p">}</span> <span class="err">$</span><span class="p">{</span><span class="n">hadoopHome</span><span class="p">}</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    creates =&amp;gt; &quot;</span><span class="err">$</span><span class="p">{</span><span class="n">hadoopHome</span><span class="p">}</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    user =&amp;gt; vagrant,</span>
</span><span class='line'><span class="s2">    require =&amp;gt; Exec[&quot;</span><span class="n">extract</span> <span class="n">distr</span><span class="s2">&quot;]</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">file { &quot;</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">hadoop</span><span class="o">.</span><span class="n">sh</span><span class="s2">&quot;:</span>
</span><span class='line'><span class="s2">    content =&amp;gt; &quot;</span><span class="n">export</span> <span class="no">HADOOP_PREFIX</span><span class="o">=</span><span class="p">\</span><span class="s2">&quot;${hadoopHome}</span><span class="se">\&quot;</span><span class="s2"></span>
</span><span class='line'><span class="s2">    export PATH=</span><span class="se">\&quot;</span><span class="s2">\$PATH:\$HADOOP_PREFIX/bin</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;${hadoopHome}/conf/slaves&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">content</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">template</span><span class="p">(</span> <span class="s2">&quot;hadoop/slaves.erb&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="n">mode</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">644</span><span class="p">,</span>
</span><span class='line'>    <span class="n">owner</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>    <span class="n">group</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">require</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Exec</span><span class="o">[</span> <span class="s2">&quot;move distr&quot;</span><span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;${hadoopHome}/conf/masters&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">content</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">template</span><span class="p">(</span> <span class="s2">&quot;hadoop/masters.erb&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="n">mode</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">644</span><span class="p">,</span>
</span><span class='line'>    <span class="n">owner</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>    <span class="n">group</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">require</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Exec</span><span class="o">[</span> <span class="s2">&quot;move distr&quot;</span><span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;${hadoopHome}/conf/core-site.xml&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">content</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">template</span><span class="p">(</span> <span class="s2">&quot;hadoop/core-site.erb&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="n">mode</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">644</span><span class="p">,</span>
</span><span class='line'>    <span class="n">owner</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>    <span class="n">group</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">require</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Exec</span><span class="o">[</span> <span class="s2">&quot;move distr&quot;</span><span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;${hadoopHome}/conf/hdfs-site.xml&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">content</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">template</span><span class="p">(</span> <span class="s2">&quot;hadoop/hdfs-site.erb&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="n">mode</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">644</span><span class="p">,</span>
</span><span class='line'>    <span class="n">owner</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>    <span class="n">group</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">require</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Exec</span><span class="o">[</span> <span class="s2">&quot;move distr&quot;</span><span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;${hadoopHome}/conf/mapred-site.xml&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">content</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">template</span><span class="p">(</span> <span class="s2">&quot;hadoop/mapred-site.erb&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="n">mode</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">644</span><span class="p">,</span>
</span><span class='line'>    <span class="n">owner</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>    <span class="n">group</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">require</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="no">Exec</span><span class="o">[</span> <span class="s2">&quot;move distr&quot;</span><span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>4. Write puppet templates for configuration files:</h3>

<p>You probably paid attention that in order to setup hadoop configuration files I&rsquo;ve used puppet templates function (you can read more <a href="http://docs.puppetlabs.com/guides/templating.html">here</a>). Therefore now we need to provide three configuration files in order to complete that part.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>masters </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">%</span> <span class="vi">@masterNode</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>slaves </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">%</span> <span class="vi">@slaveNodes</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span> <span class="o">&amp;</span><span class="n">ndash</span><span class="p">;</span><span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&amp;lt;% node %&gt;</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">%</span> <span class="k">end</span> <span class="o">&amp;</span><span class="n">ndash</span><span class="p">;</span><span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>core-site.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="ni">&amp;lt;</span>?xml version=<span class="ni">&amp;ldquo;</span>1.0<span class="ni">&amp;rdquo;</span>?&gt;
</span><span class='line'><span class="ni">&amp;lt;</span>?xml-stylesheet type=<span class="ni">&amp;ldquo;</span>text/xsl<span class="ni">&amp;rdquo;</span> href=<span class="ni">&amp;ldquo;</span>configuration.xsl<span class="ni">&amp;rdquo;</span>?&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>configuration<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>property<span class="ni">&amp;gt;</span>
</span><span class='line'>        <span class="ni">&amp;lt;</span>name<span class="ni">&amp;gt;</span>fs.default.name<span class="ni">&amp;lt;</span>/name<span class="ni">&amp;gt;</span>
</span><span class='line'>        <span class="ni">&amp;lt;</span>value<span class="ni">&amp;gt;&amp;lt;</span>%= @masterNode %<span class="ni">&amp;gt;</span>:9000<span class="ni">&amp;lt;</span>/value<span class="ni">&amp;gt;</span>
</span><span class='line'>        <span class="ni">&amp;lt;</span>description<span class="ni">&amp;gt;</span>The name of the default file system. A URI whose scheme and authority determine the FileSystem implementation.<span class="ni">&amp;lt;</span>/description<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>/property<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/configuration<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>hdfs-site.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="ni">&amp;lt;</span>?xml version=<span class="ni">&amp;ldquo;</span>1.0<span class="ni">&amp;rdquo;</span>?&gt;
</span><span class='line'><span class="ni">&amp;lt;</span>?xml-stylesheet type=<span class="ni">&amp;ldquo;</span>text/xsl<span class="ni">&amp;rdquo;</span> href=<span class="ni">&amp;ldquo;</span>configuration.xsl<span class="ni">&amp;rdquo;</span>?&gt;
</span><span class='line'><span class="nt">&lt;configuration&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>property<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>name<span class="ni">&amp;gt;</span>dfs.replication<span class="ni">&amp;lt;</span>/name<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>value<span class="ni">&amp;gt;</span>1<span class="ni">&amp;lt;</span>/value<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>description<span class="ni">&amp;gt;</span>The actual number of replications can be specified when the file is created.<span class="ni">&amp;lt;</span>/description<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/property<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;/configuration&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>mapred-site.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&amp;</span><span class="n">lt</span><span class="p">;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="sc">?&gt;</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">lt</span><span class="p">;?</span><span class="n">xml</span><span class="o">-</span><span class="n">stylesheet</span> <span class="n">type</span><span class="o">=&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">text</span><span class="o">/</span><span class="n">xsl</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="n">href</span><span class="o">=&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">configuration</span><span class="o">.</span><span class="n">xsl</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="sc">?&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">configuration</span><span class="o">&gt;&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;&amp;lt;property&amp;gt;</span>
</span><span class='line'><span class="sr">    &amp;lt;name&amp;gt;mapred.job.tracker&amp;lt;/n</span><span class="n">ame</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">value</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">%</span> <span class="vi">@masterNode</span> <span class="sx">%&amp;gt;:9001&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">value</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">description</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="no">The</span> <span class="n">host</span> <span class="ow">and</span> <span class="n">port</span> <span class="n">that</span> <span class="n">the</span> <span class="no">MapReduce</span> <span class="n">job</span> <span class="n">tracker</span> <span class="n">runs</span> <span class="n">at</span><span class="o">.</span><span class="n">&amp;lt</span><span class="p">;</span><span class="o">/</span><span class="n">description</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">property</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;&lt;</span><span class="sr">/configuration&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Where:</p>

<ul>
<li><strong>$masterNode</strong> &ndash; IP address of hadoop master node.</li>
<li><strong>$slaveNodes</strong>  &ndash;  list of IP addresses for hadoop slave nodes.</li>
<li><strong>$distrFile</strong> &ndash; hadoop distribution file name.</li>
<li><strong>$hadoopHome</strong> &ndash; desired hadoop home folder.</li>
</ul>


<h3>5. Next step is to write Vagrant file.</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Vagrant </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Vagrant</span><span class="p">:</span><span class="ss">:Config</span><span class="o">.</span><span class="n">run</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="ss">:hadoop_master</span> <span class="k">do</span> <span class="o">|</span><span class="n">hadoop_config</span><span class="o">|&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;    hadoop_config.vm.box = &quot;ubuntu&quot;</span>
</span><span class='line'><span class="sr">    hadoop_config.vm.network :hostonly, &quot;192.168.32.1&quot;</span>
</span><span class='line'><span class="sr">    hadoop_config.vm.host_name = &quot;master&quot;</span>
</span><span class='line'><span class="sr">    hadoop_config.vm.customize [ &quot;modifyvm&quot;, :id, &quot;--memory&quot;, &quot;1024&quot;]</span>
</span><span class='line'><span class="sr">    hadoop_config.vm.provision :puppet, :facter =&amp;gt; { &quot;fqdn&quot; =&amp;gt; &quot;master&quot;} do |puppet|</span>
</span><span class='line'><span class="sr">            puppet.module_path = &quot;modules&quot;</span>
</span><span class='line'><span class="sr">            puppet.manifests_path = &quot;manifests&quot;</span>
</span><span class='line'><span class="sr">            puppet.manifest_file  = &quot;hadoop.pp&quot;</span>
</span><span class='line'><span class="sr">    end</span>
</span><span class='line'><span class="sr">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;</span><span class="sr">/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  end&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="ss">:hadoop_slave</span> <span class="k">do</span> <span class="o">|</span><span class="n">hadoop_config</span><span class="o">|&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;    hadoop_config.vm.box = &quot;ubuntu&quot;</span>
</span><span class='line'><span class="sr">    hadoop_config.vm.network :hostonly, &quot;192.168.32.2&quot;</span>
</span><span class='line'><span class="sr">    hadoop_config.vm.host_name = &quot;slave&quot;</span>
</span><span class='line'><span class="sr">    hadoop_config.vm.customize [ &quot;modifyvm&quot;, :id, &quot;--memory&quot;, &quot;1024&quot;]</span>
</span><span class='line'><span class="sr">    hadoop_config.vm.provision :puppet, :facter =&amp;gt; { &quot;fqdn&quot; =&amp;gt; &quot;slave&quot;} do |puppet|</span>
</span><span class='line'><span class="sr">            puppet.module_path = &quot;modules&quot;</span>
</span><span class='line'><span class="sr">            puppet.manifests_path = &quot;manifests&quot;</span>
</span><span class='line'><span class="sr">            puppet.manifest_file  = &quot;hadoop.pp&quot;</span>
</span><span class='line'><span class="sr">    end</span>
</span><span class='line'><span class="sr">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;</span><span class="sr">/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  end</span>
</span><span class='line'><span class="sr">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>6. Now we need to write some code to combine java installation process with hadoop setup.</h3>

<p>Following script will initialize java defaults and hadoop installation.
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>hadoop.pp </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="p">{</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">hadoop</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;:</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;masterNode =&amp;gt; &quot;192.168.32.1&quot;,</span>
</span><span class='line'><span class="sr">slaveNodes =&amp;gt; [&quot;192.168.32.1&quot;, &quot;192.168.32.2&quot;],</span>
</span><span class='line'><span class="sr">distrFile  =&amp;gt; &quot;hadoop-1.2.1&quot;,</span>
</span><span class='line'><span class="sr">hadoopHome =&amp;gt; &quot;/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">hadoop</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&lt;p&gt;}</span>
</span><span class='line'><span class="s2">include java</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>7. Run virtual machines.</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant up hadoop_{master,slave}</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Now if we proceed to the last step in <a href="blog/2013/09/21/setup-hadoop-cluster/">hadoop</a> post and will try to run command on master node:
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo ./hadoop namenode -format
</span><span class='line'>sudo ./start-all.sh</span></code></pre></td></tr></table></div></figure></notextile></div>
We will notice that we have forgot to configure and publish ssh keys between nodes, hence cluster is not able to properly startup. Therefore we need to continue a bit more.</p>

<h3>8. Setup ssh keys.</h3>

<p>Run in terminal:
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh-keygen -t rsa</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>and provide key path up to your files module folder (&ldquo;modules/hadoop/files/id_rsa&rdquo; for example). Enter your passphrase, now open new generated id_rsa.pub and copy into clipboard newly generated public key.
Now we need to add following lines into our module init.pp file:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>init.pp </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;file { &quot;/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="s2">&quot;:</span>
</span><span class='line'><span class="s2">    source =&amp;gt; &quot;</span><span class="ss">puppet</span><span class="p">:</span><span class="sr">//</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">hadoop</span><span class="o">/</span><span class="n">id_rsa</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    mode =&amp;gt; 600,</span>
</span><span class='line'><span class="s2">    owner =&amp;gt; vagrant,</span>
</span><span class='line'><span class="s2">    group =&amp;gt; vagrant,</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">file { &quot;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span><span class="s2">&quot;:</span>
</span><span class='line'><span class="s2">    source =&amp;gt; &quot;</span><span class="ss">puppet</span><span class="p">:</span><span class="sr">//</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">hadoop</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    mode =&amp;gt; 600,</span>
</span><span class='line'><span class="s2">    owner =&amp;gt; vagrant,</span>
</span><span class='line'><span class="s2">    group =&amp;gt; vagrant,</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">ssh_authorized_key { &quot;</span><span class="n">ssh_key</span><span class="s2">&quot;:</span>
</span><span class='line'><span class="s2">    ensure =&amp;gt; &quot;</span><span class="n">present</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    key =&amp;gt; &quot;</span><span class="n">past</span> <span class="n">here</span> <span class="n">content</span> <span class="n">from</span> <span class="n">your</span> <span class="n">clipboard</span> <span class="p">(</span><span class="kp">public</span> <span class="n">key</span> <span class="n">value</span> <span class="n">from</span> <span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span> <span class="n">file</span><span class="p">)</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    type =&amp;gt; &quot;</span><span class="n">ssh</span><span class="o">-</span><span class="n">rsa</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    user =&amp;gt; vagrant,</span>
</span><span class='line'><span class="s2">    require =&amp;gt; File[&quot;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span><span class="s2">&quot;]</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>9. Enjoy.</h3>

<p>Now you can reload virtual machines</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant reload hadoop_{master,slave}</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>then loggin into master node</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant ssh hadoop_master</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>and finally start cluster</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo ./hadoop namenode -format
</span><span class='line'>sudo ./start-all.sh</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>You can find sources on my <a href="https://github.com/C0rWin/hadoop-puppet">github</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Install Maven on VM with Puppet]]></title>
    <link href="http://pensieve.info/blog/2013/09/22/install-maven-on-vm-with-puppet/"/>
    <updated>2013-09-22T23:26:00+03:00</updated>
    <id>http://pensieve.info/blog/2013/09/22/install-maven-on-vm-with-puppet</id>
    <content type="html"><![CDATA[<p>In my <a href="blog/2013/09/21/install-java-on-vm-using-vagrant-and-puppet">previous</a> post I&rsquo;ve explained how to setup Java on virtual machine using <a href="http://puppetlabs.com/">Puppet</a>. Now it&rsquo;s a time to make it for maven, basically most of the steps are the same.</p>

<!-- more -->


<h3>1. Download maven archive.</h3>

<p>Visit Apache <a href="http://maven.apache.org/download.cgi">Maven site</a> and download recent binary tar gz archived maven version.</p>

<h3>2. Create maven puppet module folders.</h3>

<p>Execute following terminal command in your working directory:
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir -p modules/maven/{files,manifests}</span></code></pre></td></tr></table></div></figure></notextile></div>
And copy downloaded maven binaries archive (apache-maven-3.1.0-bin.tar.gz in my case) into files sub-folder:
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp apache-maven-3.1.0-bin.tar.gz modules/maven/files/</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>3. Write down configuration script.</h3>

<p>Create <em>init.pp</em> files inside manifests folder
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>touch modules/maven/manifests/init.pp</span></code></pre></td></tr></table></div></figure></notextile></div>
Now let&rsquo;s put there following implementation:
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="n">maven</span> <span class="p">(</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;$maven_home = &quot;/us</span><span class="n">r</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">maven</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">$maven_archive = &quot;</span><span class="n">apache</span><span class="o">-</span><span class="n">maven</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">bin</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">$maven_folder = &quot;</span><span class="n">apache</span><span class="o">-</span><span class="n">maven</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="s2">&quot;) {</span>
</span><span class='line'>
</span><span class='line'><span class="s2">Exec {</span>
</span><span class='line'><span class="s2">    path =&amp;gt; [ &quot;</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="s2">&quot;, &quot;</span><span class="o">/</span><span class="n">bin</span><span class="s2">&quot;, &quot;</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="s2">&quot;]</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">file { &quot;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">maven_archive</span><span class="p">}</span><span class="s2">&quot;:</span>
</span><span class='line'><span class="s2">    ensure =&amp;gt; present,</span>
</span><span class='line'><span class="s2">    source =&amp;gt; &quot;</span><span class="ss">puppet</span><span class="p">:</span><span class="sr">//</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">maven</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">maven_archive</span><span class="p">}</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    owner =&amp;gt; vagrant,</span>
</span><span class='line'><span class="s2">    mode =&amp;gt; 755,</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">exec { &quot;</span><span class="n">extract</span> <span class="n">maven</span><span class="s2">&quot;:</span>
</span><span class='line'><span class="s2">    command =&amp;gt; &quot;</span><span class="n">tar</span> <span class="n">xfv</span> <span class="err">$</span><span class="p">{</span><span class="n">maven_archive</span><span class="p">}</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    cwd =&amp;gt; &quot;</span><span class="o">/</span><span class="n">tmp</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    creates =&amp;gt; &quot;</span><span class="err">$</span><span class="p">{</span><span class="n">maven_home</span><span class="p">}</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    require =&amp;gt; File[&quot;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">maven_archive</span><span class="p">}</span><span class="s2">&quot;]</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">exec { &quot;</span><span class="n">move</span> <span class="n">maven</span><span class="s2">&quot;:</span>
</span><span class='line'><span class="s2">    command =&amp;gt; &quot;</span><span class="n">mv</span> <span class="err">$</span><span class="p">{</span><span class="n">maven_folder</span><span class="p">}</span> <span class="err">$</span><span class="p">{</span><span class="n">maven_home</span><span class="p">}</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    creates =&amp;gt; &quot;</span><span class="err">$</span><span class="p">{</span><span class="n">maven_home</span><span class="p">}</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    cwd =&amp;gt; &quot;</span><span class="o">/</span><span class="n">tmp</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">    require =&amp;gt; Exec[&quot;</span><span class="n">extract</span> <span class="n">maven</span><span class="s2">&quot;]</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">file { &quot;</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">maven</span><span class="o">.</span><span class="n">sh</span><span class="s2">&quot;:</span>
</span><span class='line'><span class="s2">    content =&amp;gt;   &quot;</span><span class="n">export</span> <span class="no">MAVEN_HOME</span><span class="o">=</span><span class="err">$</span><span class="p">{</span><span class="n">maven_home</span><span class="p">}</span>
</span><span class='line'>                  <span class="n">export</span> <span class="no">M2</span><span class="o">=</span><span class="p">\</span><span class="vg">$MAVEN_HOME</span><span class="o">/</span><span class="n">bin</span>
</span><span class='line'>                  <span class="n">export</span> <span class="no">PATH</span><span class="o">=</span><span class="p">\</span><span class="vg">$PATH</span><span class="p">:\</span><span class="vg">$M2</span>
</span><span class='line'>                  <span class="n">export</span> <span class="no">MAVEN_OPTS</span><span class="o">=</span><span class="p">\</span><span class="s2">&quot;-Xmx512m -Xms512m</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>4. Put everything together.</h3>

<p>I&rsquo;ll continue to use Vagrantfile and manifest from <a href="blog/2013/09/21/install-java-on-vm-using-vagrant-and-puppet">previous</a> post, therefore in order to test my new puppet script for maven install I&rsquo;ll just use already create test_vm.pp and add following lines:
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal WIndow </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo &ldquo;include maven&rdquo; >> manifests/test_vm.pp</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>5. Reload VM (or start).</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant reload test_vm</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>6. Enjoy!</h3>

<p> In my next post I&rsquo;ll finilize and put together current result with script from my <a href="blog/2013/09/21/install-java-on-vm-using-vagrant-and-puppet">previous</a> post in order to implement scripts which will enable to setup Hadoop cluster on VM. Therefore all I&rsquo;ve described in my <a href="blog/2013/09/21/setup-hadoop-cluster/">first</a> post could be easily automated.</p>

<p>PS. Here I&rsquo;ve changed the puppet script same way as in my <a href="blog/2013/09/21/install-java-on-vm-using-vagrant-and-puppet">previous</a> post, to support parametrized class definition to support customization.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Install Java on VM using Vagrant and Puppet]]></title>
    <link href="http://pensieve.info/blog/2013/09/21/install-java-on-vm-using-vagrant-and-puppet/"/>
    <updated>2013-09-21T23:25:00+03:00</updated>
    <id>http://pensieve.info/blog/2013/09/21/install-java-on-vm-using-vagrant-and-puppet</id>
    <content type="html"><![CDATA[<p>As part of my work I need to be able to test different Java Web applications. I need to be able to run some tests on more then only single computer, hence I need rapid way of setting up several Linux based computers/servers with configured Java running, usually I&rsquo;m using Ubuntu based destributives.</p>

<p>Therefore I&rsquo;ve choose the winning couple of <a href="http://puppetlabs.com/">Puppet</a> and <a href="http://www.vagrantup.com/">Vagrant</a>. You&rsquo;re more than welcome to read about these tools and I&rsquo;ll skip the installation guide for them, since google has pleanty of different tutorials explaning how to do it for different platform, so you just need to pick the right one for you.</p>

<!-- more -->


<p>I&rsquo;m going to show how to leverage <a href="http://puppetlabs.com/">Puppet</a> modules architecture, how to implement new module which will be capable to install and configure Java for new VM machine. To learn more about modules in <a href="http://puppetlabs.com/">Puppet</a>, please take a look on <a href="http://docs.puppetlabs.com/puppet/2.7/reference/modules_fundamentals.html">modules fundamentals</a> article on <a href="http://puppetlabs.com/">Puppet</a> labs site.</p>

<h3>1. Download Java.</h3>

<p>Very first step which has to be done, is to download tar gz archive of Java JDK or (JRE), from Oracle official <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html">site</a>. By the time I&rsquo;m writting this post current lates JDK tar gz is <em>jdk-7u40-linux-i586.tar.gz</em>.</p>

<h3>2. Create new Puppet module.</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir -p modules/java/{files,manifests}</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>3. Copy Java JDK into module folders.</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp jdk-7u40-linux-i586.tar.gz modules/java/files/</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>4. Write module implementation.</h3>

<ul>
<li>Create <em>init.pp</em> file within <strong>manifests</strong> folder
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal WIndow </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>touch modules/java/manifests/init.pp</span></code></pre></td></tr></table></div></figure></notextile></div></li>
<li><p>Now we need to write down following content:
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>init.pp  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="n">java</span><span class="p">(</span>
</span><span class='line'>  <span class="vg">$java_archive</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">jdk</span><span class="o">-</span><span class="mi">7</span><span class="n">u40</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span>
</span><span class='line'>  <span class="vg">$java_home</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/</span><span class="n">jdk1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mo">0_40</span><span class="o">/&amp;</span><span class="n">rdquo</span><span class="p">;,</span>
</span><span class='line'>  <span class="vg">$java_folder</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">jdk1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mo">0_40</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;)</span><span class="o">&lt;</span><span class="n">br</span><span class="o">/&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  Exec {</span>
</span><span class='line'><span class="sr">      path =&gt; [ &amp;ldquo;/us</span><span class="n">r</span><span class="o">/</span><span class="n">bin</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">/</span><span class="n">bin</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">]</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  file { &amp;ldquo;/</span><span class="n">tmp</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">java_archive</span><span class="p">}</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="p">:</span>
</span><span class='line'>      <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">present</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span>
</span><span class='line'>      <span class="n">source</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="ss">puppet</span><span class="p">:</span><span class="sr">//</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">java_archive</span><span class="p">}</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span>
</span><span class='line'>      <span class="n">owner</span>  <span class="o">=&gt;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>      <span class="n">mode</span>   <span class="o">=&gt;</span> <span class="mi">755</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  exec { &amp;lsquo;extract jdk&amp;rsquo;:</span>
</span><span class='line'><span class="sr">      cwd =&gt; &amp;lsquo;/</span><span class="n">tmp</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;,</span>
</span><span class='line'>      <span class="n">command</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">tar</span> <span class="n">xfv</span> <span class="err">$</span><span class="p">{</span><span class="n">java_archive</span><span class="p">}</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span>
</span><span class='line'>      <span class="n">creates</span> <span class="o">=&gt;</span> <span class="vg">$java_home</span><span class="p">,</span>
</span><span class='line'>      <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">java_archive</span><span class="p">}</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  file { &amp;lsquo;/us</span><span class="n">r</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span> <span class="p">:</span>
</span><span class='line'>      <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">directory</span><span class="p">,</span>
</span><span class='line'>      <span class="n">owner</span> <span class="o">=&gt;</span> <span class="n">vagrant</span><span class="p">,</span>
</span><span class='line'>      <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Exec</span><span class="o">[&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">extract</span> <span class="n">jdk</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="o">]</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  exec { &amp;lsquo;move jdk&amp;rsquo;:</span>
</span><span class='line'><span class="sr">      cwd =&gt; &amp;lsquo;/</span><span class="n">tmp</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;,</span>
</span><span class='line'>      <span class="n">creates</span> <span class="o">=&gt;</span> <span class="vg">$java_home</span><span class="p">,</span>
</span><span class='line'>      <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>      <span class="n">command</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">mv</span> <span class="err">$</span><span class="p">{</span><span class="n">java_folder</span><span class="p">}</span> <span class="sr">/usr/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  exec {&amp;lsquo;install java&amp;rsquo;:</span>
</span><span class='line'><span class="sr">      require =&gt; Exec[&amp;lsquo;move jdk&amp;rsquo;],</span>
</span><span class='line'><span class="sr">      logoutput =&gt; true,</span>
</span><span class='line'><span class="sr">      command =&gt; &amp;ldquo;update-alternatives &amp;mdash;install /</span><span class="n">bin</span><span class="o">/</span><span class="n">java</span> <span class="n">java</span> <span class="err">$</span><span class="p">{</span><span class="n">java_home</span><span class="p">}</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">java</span> <span class="mi">1</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  exec {&amp;lsquo;set java&amp;rsquo;:</span>
</span><span class='line'><span class="sr">      require =&gt; Exec[&amp;lsquo;install java&amp;rsquo;],</span>
</span><span class='line'><span class="sr">      logoutput =&gt; true,</span>
</span><span class='line'><span class="sr">      command =&gt; &amp;ldquo;update-alternatives &amp;mdash;set java ${java_home}/</span><span class="n">bin</span><span class="o">/</span><span class="n">java</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  exec {&amp;lsquo;install javac&amp;rsquo;:</span>
</span><span class='line'><span class="sr">      require =&gt; Exec[&amp;lsquo;move jdk&amp;rsquo;],</span>
</span><span class='line'><span class="sr">      logoutput =&gt; true,</span>
</span><span class='line'><span class="sr">      command =&gt; &amp;ldquo;update-alternatives &amp;mdash;install /</span><span class="n">bin</span><span class="o">/</span><span class="n">javac</span> <span class="n">javac</span> <span class="err">$</span><span class="p">{</span><span class="n">java_home</span><span class="p">}</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">javac</span> <span class="mi">1</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  exec {&amp;lsquo;set javac&amp;rsquo;:</span>
</span><span class='line'><span class="sr">      require =&gt; Exec[&amp;lsquo;install javac&amp;rsquo;],</span>
</span><span class='line'><span class="sr">      logoutput =&gt; true,</span>
</span><span class='line'><span class="sr">      command =&gt; &amp;ldquo;update-alternatives &amp;mdash;set javac ${java_home}/</span><span class="n">bin</span><span class="o">/</span><span class="n">javac</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  file { &amp;ldquo;/e</span><span class="n">tc</span><span class="o">/</span><span class="n">profile</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">java</span><span class="o">.</span><span class="n">sh</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;:</span>
</span><span class='line'>      <span class="n">content</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">export</span> <span class="no">JAVA_HOME</span><span class="o">=</span><span class="err">$</span><span class="p">{</span><span class="n">java_home</span><span class="p">}</span>
</span><span class='line'>                   <span class="n">export</span> <span class="no">PATH</span><span class="o">=</span><span class="p">\</span><span class="vg">$PATH</span><span class="p">:\</span><span class="vg">$JAVA_HOME</span><span class="o">/</span><span class="n">bin</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>5. Run and test new module.</h3></li>
<li><p>Run:
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant init</span></code></pre></td></tr></table></div></figure></notextile></div></p></li>
<li>Edit Vagrantfile, put following content:
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Vagrantfile </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Vagrant</span><span class="p">:</span><span class="ss">:Config</span><span class="o">.</span><span class="n">run</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="ss">:test_vm</span> <span class="k">do</span> <span class="o">|</span><span class="n">test_vm</span><span class="o">|</span>
</span><span class='line'>      <span class="n">test_vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">ubuntu</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>      <span class="n">test_vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:hostonly</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="mi">10</span><span class="o">.</span><span class="mi">71</span><span class="o">.</span><span class="mi">71</span><span class="o">.</span><span class="mi">10</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>      <span class="n">test_vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">modifyvm</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="ss">:id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">&amp;</span><span class="n">mdash</span><span class="p">;</span><span class="n">memory</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="mi">1024</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">]</span>
</span><span class='line'>      <span class="n">test_vm</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:puppet</span> <span class="k">do</span> <span class="o">|</span><span class="n">puppet</span><span class="o">|</span>
</span><span class='line'>              <span class="n">puppet</span><span class="o">.</span><span class="n">module_path</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">~</span><span class="sr">/vagrant/m</span><span class="n">anifests</span><span class="o">/&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>              <span class="n">puppet</span><span class="o">.</span><span class="n">module_path</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">modules</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>              <span class="n">puppet</span><span class="o">.</span><span class="n">manifests_path</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">manifests</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>              <span class="n">puppet</span><span class="o">.</span><span class="n">manifest_file</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">test_vm</span><span class="o">.</span><span class="n">pp</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></li>
<li>Create <em>manifests</em> folder and <em>test_vm.pp</em>:
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir manifests &amp;&amp; touch manifests/test_vm.pp
</span><span class='line'>echo &ldquo;include java&rdquo; >> manifests/test_vm.pp</span></code></pre></td></tr></table></div></figure></notextile></div></li>
<li>Run VM
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Terminal Window </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant up test_vm</span></code></pre></td></tr></table></div></figure></notextile></div></li>
</ul>


<h3>6. Enjoy!</h3>

<p>PS. Thanks to my friend which pointed me to more nice and clear way of declaring variable in a class in a way it could be customized later with values different from defaults. I&rsquo;ve update the post and here you can see the customization example:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>test_vm.pp</span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="p">{</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">java</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;:</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;java_archive =&amp;gt; &quot;jdk-8u01-linux-x64.tar.gz&quot;,</span>
</span><span class='line'><span class="sr">java_home =&amp;gt; &quot;/us</span><span class="n">r</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/</span><span class="n">jdk1</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mo">0_01</span><span class="o">/</span><span class="s2">&quot;,</span>
</span><span class='line'><span class="s2">java_folder =&amp;gt; &quot;</span><span class="n">jdk1</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mo">0_01</span><span class="s2">&quot;)  </span>
</span><span class='line'><span class="s2">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&lt;p&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
</feed>
